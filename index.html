<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Registre Prises M√©dicaments</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f9;
  padding: 20px;
}

.container {
  max-width: 800px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

h1 {
  text-align: center;
  margin-bottom: 15px;
}

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.full {
  grid-column: 1 / -1;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
}

textarea {
  resize: none;
  height: 70px;
}

button {
  background: #2563eb;
  color: white;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

button:hover {
  background: #1e40af;
}

.record {
  background: #f1f5f9;
  padding: 12px;
  border-radius: 8px;
  margin-top: 10px;
  border-left: 4px solid #2563eb;
}

.small {
  font-size: 12px;
  color: gray;
}
</style>
</head>

<body>

<div class="container">

<h1>üíä Registre de prises de m√©dicaments</h1>

<div class="grid">
  <select id="medicament">
    <option value="">S√©lectionner un m√©dicament</option>
    <option>Parac√©tamol</option>
    <option>Ibuprof√®ne</option>
    <option>Aspirine</option>
    <option>Doliprane</option>
    <option>Efferalgan</option>
    <option>Amoxicilline</option>
    <option>Vitamine C</option>
    <option>Autre</option>
  </select>

  <input id="nouveauMed" placeholder="Nom si Autre" style="display:none">

  <input id="dose" placeholder="Dose (ex: 500 mg)">
  <input type="datetime-local" id="dateHeure">

  <textarea id="note" class="full" placeholder="Remarque (facultatif)"></textarea>

  <button onclick="ajouterPrise()" class="full">‚ûï Enregistrer la prise</button>
</div>

<h3 style="margin-top:20px">üïí Historique</h3>
<div id="liste"></div>

</div>

<script type="module">
// Import Firebase SDK
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase Config (TA CONFIG)
const firebaseConfig = {
  apiKey: "AIzaSyD7njwfHFdCzdnP4xfetF50jn_Glde3Gug",
  authDomain: "registre-medicament-2.firebaseapp.com",
  projectId: "registre-medicament-2",
  storageBucket: "registre-medicament-2.firebasestorage.app",
  messagingSenderId: "107773329662",
  appId: "1:107773329662:web:ce53ec013d660b50eca5af"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Gestion champ "Autre"
const select = document.getElementById("medicament");
const champNouveau = document.getElementById("nouveauMed");

select.addEventListener("change", () => {
  champNouveau.style.display = select.value === "Autre" ? "block" : "none";
});

// Ajouter prise
window.ajouterPrise = async function () {
  let medicament = select.value;
  let nouveau = champNouveau.value.trim();
  let dose = document.getElementById("dose").value.trim();
  let dateHeure = document.getElementById("dateHeure").value;
  let note = document.getElementById("note").value.trim();

  if (medicament === "Autre") {
    if (!nouveau) return alert("Entre le nom du m√©dicament");
    medicament = nouveau;
  }

  if (!medicament || !dose || !dateHeure) {
    return alert("Remplis m√©dicament, dose et date/heure");
  }

  try {
    await addDoc(collection(db, "prises"), {
      medicament,
      dose,
      dateheure: dateHeure,
      note,
      createdAt: new Date()
    });

    alert("‚úÖ Prise enregistr√©e !");
    champNouveau.value = "";
    document.getElementById("dose").value = "";
    document.getElementById("note").value = "";

    chargerPrises();

  } catch (e) {
    alert("‚ùå Erreur Firebase : " + e.message);
  }
};

// Charger historique
async function chargerPrises() {
  let liste = document.getElementById("liste");
  liste.innerHTML = "";

  try {
    const q = query(collection(db, "prises"), orderBy("createdAt", "desc"));
    const querySnapshot = await getDocs(q);

    querySnapshot.forEach((doc) => {
      let p = doc.data();

      let div = document.createElement("div");
      div.className = "record";

      div.innerHTML = `
        <strong>${p.medicament}</strong><br>
        Dose : ${p.dose}<br>
        Date : ${new Date(p.dateheure).toLocaleString()}<br>
        ${p.note ? "<span class='small'>Note : " + p.note + "</span>" : ""}
      `;

      liste.appendChild(div);
    });

  } catch (e) {
    console.error(e);
    alert("‚ùå Impossible de charger l'historique");
  }
}

// Chargement auto
chargerPrises();
</script>

</body>
</html>
